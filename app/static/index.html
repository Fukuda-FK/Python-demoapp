<!DOCTYPE html>
<html lang="ja">
<head>
    <script type="text/javascript">
;window.NREUM||(NREUM={});NREUM.init={session_replay:{enabled:true,block_selector:"",mask_text_selector:"*",sampling_rate:100.0,error_sampling_rate:100.0,mask_all_inputs:true,collect_fonts:true,inline_images:false,inline_stylesheet:true,fix_stylesheets:true,preload:false,mask_input_options:{}},distributed_tracing:{enabled:true},performance:{capture_measures:true},privacy:{cookies_enabled:true},ajax:{deny_list:["bam.nr-data.net"]}};
;NREUM.loader_config={accountID:"3688120",trustKey:"3420523",agentID:"1103447806",licenseKey:"NRJS-dfb894caf5e1edd9871",applicationID:"1103447806"};
;NREUM.info={beacon:"bam.nr-data.net",errorBeacon:"bam.nr-data.net",licenseKey:"NRJS-dfb894caf5e1edd9871",applicationID:"1103447806",sa:1};
    </script>
    <script src="https://js-agent.newrelic.com/nr-loader-spa-1.298.0.min.js"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã‚¹ãƒˆã‚¢ - FastAPI ãƒ‡ãƒ¢</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            padding: 40px;
            max-width: 500px;
            width: 100%;
        }
        h1 { color: #333; margin-bottom: 10px; font-size: 28px; }
        .subtitle { color: #666; margin-bottom: 30px; font-size: 14px; }
        .form-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; color: #555; font-weight: 600; font-size: 14px; }
        input, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        input:focus, select:focus { outline: none; border-color: #667eea; }
        .btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4); }
        .btn:disabled { background: #ccc; cursor: not-allowed; transform: none; }
        .result { margin-top: 20px; padding: 15px; border-radius: 8px; font-size: 14px; display: none; }
        .result.success { background: #d4edda; border: 1px solid #c3e6cb; color: #155724; display: block; }
        .result.error { background: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; display: block; }
        .result.processing { background: #d1ecf1; border: 1px solid #bee5eb; color: #0c5460; display: block; }
        .tabs { display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 2px solid #e0e0e0; }
        .tab { padding: 10px 20px; background: none; border: none; cursor: pointer; font-size: 16px; color: #666; }
        .tab.active { color: #667eea; border-bottom: 3px solid #667eea; font-weight: 600; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .products { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px; }
        .product { border: 2px solid #e0e0e0; border-radius: 8px; padding: 15px; text-align: center; }
        .product .price { color: #667eea; font-size: 18px; font-weight: 600; margin: 10px 0; }
        .product button { width: 100%; padding: 8px; background: #667eea; color: white; border: none; border-radius: 5px; cursor: pointer; }
        .cart-item { display: flex; justify-content: space-between; padding: 10px; border-bottom: 1px solid #e0e0e0; }
        .loading { display: inline-block; width: 20px; height: 20px; border: 3px solid #f3f3f3; border-top: 3px solid #667eea; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ›’ ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã‚¹ãƒˆã‚¢</h1>
        <p class="subtitle">FastAPI ãƒ¯ãƒ¼ã‚¯ãƒ­ãƒ¼ãƒ‰ ãƒ‡ãƒ¢</p>
        
        <div class="tabs">
            <button class="tab active" onclick="showTab('shop')">å•†å“ä¸€è¦§</button>
            <button class="tab" onclick="showTab('cart')">ã‚«ãƒ¼ãƒˆ</button>
            <button class="tab" onclick="showTab('db')">DBç®¡ç†</button>
            <button class="tab" onclick="showTab('admin')"> ç®¡ç†ç”»é¢</button>
        </div>
        
        <div id="shop" class="tab-content active">
            <h2>å•†å“ä¸€è¦§</h2>
            <div class="products" id="productList"></div>
        </div>
        
        <div id="cart" class="tab-content">
            <h2>ã‚·ãƒ§ãƒƒãƒ”ãƒ³ã‚°ã‚«ãƒ¼ãƒˆ</h2>
            <div id="cartItems"></div>
            <div style="text-align: right; padding: 15px 0; font-size: 20px;">
                <strong>åˆè¨ˆ: Â¥<span id="cartTotal">0</span></strong>
            </div>
            <button onclick="checkout()" class="btn">ãƒ¬ã‚¸ã«é€²ã‚€</button>
        </div>
        
        <div id="db" class="tab-content">
            <h2> ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç®¡ç†</h2>
            <div style="background: #e3f2fd; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h3> RDSæ¥ç¶šãƒ†ã‚¹ãƒˆ</h3>
                <button onclick="testRDSConnection()" class="btn" style="margin-top: 10px;">æ¥ç¶šãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
                <div id="rdsTestResult" style="margin-top: 15px;"></div>
            </div>
            <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h3> ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å±¥æ­´</h3>
                <button onclick="loadTransactions()" class="btn" style="margin-top: 10px;">å±¥æ­´ã‚’èª­ã¿è¾¼ã‚€</button>
                <div id="transactionList" style="margin-top: 15px; max-height: 300px; overflow-y: auto;"></div>
            </div>
            <div style="background: #fff3cd; padding: 20px; border-radius: 8px;">
                <h3> ãƒ‡ãƒ¼ã‚¿ç®¡ç†</h3>
                <button onclick="clearTransactions()" class="btn" style="margin-top: 10px; background: #dc3545;">å…¨ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å‰Šé™¤</button>
                <div id="clearResult" style="margin-top: 15px;"></div>
            </div>
        </div>
        
        <div id="admin" class="tab-content">
            <h2>ğŸ”§ ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†ç”»é¢</h2>
            <div style="background: #fff3cd; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h3> New Relicãƒ‡ãƒ¢ã‚·ãƒŠãƒªã‚ª</h3>
                <p style="font-size: 13px; color: #856404; margin: 10px 0;">éšœå®³ç™ºç”Ÿæ™‚ã®åŸå› ç‰¹å®šã‚’è¿…é€ŸåŒ–</p>
                <div style="display: grid; gap: 8px; margin-top: 15px;">
                    <button onclick="enableCodeError()" class="btn" style="background: #e74c3c; font-size: 14px;"> ã‚·ãƒŠãƒªã‚ª1: ã‚³ãƒ¼ãƒ‰ã‚¨ãƒ©ãƒ¼</button>
                    <button onclick="enableDBError()" class="btn" style="background: #9b59b6; font-size: 14px;"> ã‚·ãƒŠãƒªã‚ª2: DBã‚¨ãƒ©ãƒ¼</button>
                    <button onclick="enableResourceError()" class="btn" style="background: #f39c12; font-size: 14px;"> ã‚·ãƒŠãƒªã‚ª3: ãƒªã‚½ãƒ¼ã‚¹ä¸è¶³</button>
                    <button onclick="disableAllErrors()" class="btn" style="background: #27ae60; font-size: 14px;"> å…¨ã¦æ­£å¸¸åŒ–</button>
                </div>
            </div>
            <div style="background: #e3f2fd; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h3> New Relicã§ç¢ºèªã§ãã‚‹ã“ã¨</h3>
                <div style="font-size: 13px; line-height: 1.8;">
                    <p><strong>ã‚·ãƒŠãƒªã‚ª1:</strong> APMã§ã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹ã‚’ç¢ºèªã€ã‚³ãƒ¼ãƒ‰ã®ä½•è¡Œç›®ã§ã‚¨ãƒ©ãƒ¼ã‹å³åº§ã«åˆ¤æ˜</p>
                    <p><strong>ã‚·ãƒŠãƒªã‚ª2:</strong> DBã‚¯ã‚¨ãƒªã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’ç¢ºèªã€SQLã‚¨ãƒ©ãƒ¼ã‚’Logs in Contextã§ç´ä»˜ã‘</p>
                    <p><strong>ã‚·ãƒŠãƒªã‚ª3:</strong> Infrastructureã§CPU/ãƒ¡ãƒ¢ãƒªä½¿ç”¨ç‡ã‚’ç¢ºèªã€ãƒªã‚½ãƒ¼ã‚¹å•é¡Œã‚’ç‰¹å®š</p>
                    <p style="margin-top: 10px; color: #0277bd;"><strong>â†’ APM + Logs + Infrastructureã‚’çµ±åˆã—ã¦åŸå› ã‚’è¿…é€Ÿã«ç‰¹å®šï¼</strong></p>
                </div>
            </div>
            <button onclick="getSystemStatus()" class="btn">çŠ¶æ…‹ã‚’ç¢ºèª</button>
            <div id="systemStatus" style="margin-top: 15px;"></div>
        </div>
        
        <div id="checkout-form" class="tab-content">
            <h2>æ±ºæ¸ˆæƒ…å ±å…¥åŠ›</h2>
            <button onclick="showTab('cart')" class="btn" style="background: #ccc; margin-bottom: 15px;">â† ã‚«ãƒ¼ãƒˆã«æˆ»ã‚‹</button>
            <form id="paymentForm">
                <div class="form-group">
                    <label>æ±ºæ¸ˆé‡‘é¡ï¼ˆå††ï¼‰</label>
                    <input type="number" id="amount" readonly>
                </div>
                <div class="form-group">
                    <label>ã‚«ãƒ¼ãƒ‰ç•ªå·</label>
                    <input type="text" id="cardNumber" placeholder="1234-5678-9012-3456" maxlength="19">
                </div>
                <div class="form-group">
                    <label>åº—èˆ—ID</label>
                    <select id="storeId">
                        <option value="STORE001">åº—èˆ—Aï¼ˆæ±äº¬ï¼‰</option>
                        <option value="STORE002">åº—èˆ—Bï¼ˆå¤§é˜ªï¼‰</option>
                        <option value="STORE003">åº—èˆ—Cï¼ˆåå¤å±‹ï¼‰</option>
                    </select>
                </div>
                <button type="submit" class="btn">æ±ºæ¸ˆã‚’å®Ÿè¡Œ</button>
            </form>
            <div id="result" class="result"></div>
        </div>
    </div>

    <script>
        let cart = [];
        const products = [
            { id: 1, name: 'ãƒãƒ¼ãƒˆãƒ‘ã‚½ã‚³ãƒ³', price: 89800, image: 'ğŸ’»' },
            { id: 2, name: 'ãƒ¯ã‚¤ãƒ¤ãƒ¬ã‚¹ãƒã‚¦ã‚¹', price: 2980, image: 'ğŸ–±ï¸' },
            { id: 3, name: 'ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰', price: 5980, image: 'âŒ¨ï¸' },
            { id: 4, name: 'ãƒ¢ãƒ‹ã‚¿ãƒ¼', price: 29800, image: 'ğŸ–¥ï¸' }
        ];
        
        function showTab(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
            if (tabName === 'cart') updateCart();
        }
        
        function renderProducts() {
            document.getElementById('productList').innerHTML = products.map(p => `
                <div class="product">
                    <div style="font-size: 60px;">${p.image}</div>
                    <h3>${p.name}</h3>
                    <div class="price">Â¥${p.price.toLocaleString()}</div>
                    <button onclick="addToCart(${p.id})">ã‚«ãƒ¼ãƒˆã«è¿½åŠ </button>
                </div>
            `).join('');
        }
        
        function addToCart(productId) {
            const product = products.find(p => p.id === productId);
            const existing = cart.find(item => item.id === productId);
            if (existing) {
                existing.quantity++;
            } else {
                cart.push({ ...product, quantity: 1 });
            }
            alert(`${product.name}ã‚’ã‚«ãƒ¼ãƒˆã«è¿½åŠ ã—ã¾ã—ãŸ`);
        }
        
        function updateCart() {
            const cartItems = document.getElementById('cartItems');
            const cartTotal = document.getElementById('cartTotal');
            
            if (cart.length === 0) {
                cartItems.innerHTML = '<p style="text-align: center; color: #666;">ã‚«ãƒ¼ãƒˆã¯ç©ºã§ã™</p>';
                cartTotal.textContent = '0';
                return;
            }
            
            cartItems.innerHTML = cart.map((item, index) => `
                <div class="cart-item">
                    <div><strong>${item.name}</strong><br>Â¥${item.price.toLocaleString()} Ã— ${item.quantity}</div>
                    <button onclick="removeFromCart(${index})" style="background: #f44336; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer;">å‰Šé™¤</button>
                </div>
            `).join('');
            
            const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            cartTotal.textContent = total.toLocaleString();
        }
        
        function removeFromCart(index) {
            cart.splice(index, 1);
            updateCart();
        }
        
        function checkout() {
            if (cart.length === 0) {
                alert('ã‚«ãƒ¼ãƒˆãŒç©ºã§ã™');
                return;
            }
            const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            document.getElementById('amount').value = total;
            document.getElementById('checkout-form').classList.add('active');
            document.getElementById('cart').classList.remove('active');
        }
        
        async function enableCodeError() {
            const response = await fetch('/admin/code-error', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ enable: true })
            });
            const data = await response.json();
            alert(` ${data.message}\n\næ¬¡ã®æ±ºæ¸ˆã§ZeroDivisionErrorãŒç™ºç”Ÿã—ã¾ã™ã€‚\nNew Relic APMã§ã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚`);
            getSystemStatus();
        }
        
        async function enableDBError() {
            const response = await fetch('/admin/db-error', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ enable: true })
            });
            const data = await response.json();
            alert(` ${data.message}\n\næ¬¡ã®æ±ºæ¸ˆã§DBã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã™ã€‚\nNew Relicã§DBã‚¯ã‚¨ãƒªã¨ãƒ­ã‚°ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚`);
            getSystemStatus();
        }
        
        async function enableResourceError() {
            const response = await fetch('/admin/resource-error', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ enable: true })
            });
            const data = await response.json();
            alert(` ${data.message}\n\næ¬¡ã®æ±ºæ¸ˆã§ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ãŒå¢—åŠ ã—ã¾ã™ã€‚\nNew Relic Infrastructureã§ãƒªã‚½ãƒ¼ã‚¹ä½¿ç”¨ç‡ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚`);
            getSystemStatus();
        }
        
        async function disableAllErrors() {
            await fetch('/admin/code-error', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ enable: false })
            });
            await fetch('/admin/db-error', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ enable: false })
            });
            await fetch('/admin/resource-error', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ enable: false })
            });
            alert(' å…¨ã¦ã®ã‚¨ãƒ©ãƒ¼ãƒ¢ãƒ¼ãƒ‰ãŒç„¡åŠ¹åŒ–ã•ã‚Œã¾ã—ãŸ');
            getSystemStatus();
        }
        
        async function getSystemStatus() {
            const statusDiv = document.getElementById('systemStatus');
            statusDiv.innerHTML = '<div class="loading"></div>ç¢ºèªä¸­...';
            
            const response = await fetch('/admin/status');
            const data = await response.json();
            
            const codeErrorStatus = data.codeErrorMode ? 'ğŸ”´ ON' : 'ğŸŸ¢ OFF';
            const dbErrorStatus = data.dbErrorMode ? 'ğŸ”´ ON' : 'ğŸŸ¢ OFF';
            const resourceErrorStatus = data.resourceErrorMode ? 'ğŸ”´ ON' : 'ğŸŸ¢ OFF';
            const dbStatus = data.database === 'connected' ? 'ğŸŸ¢ æ¥ç¶šä¸­' : 'ğŸ”´ åˆ‡æ–­';
            
            statusDiv.innerHTML = `
                <div style="background: white; padding: 15px; border-radius: 8px; border: 1px solid #ddd;">
                    <div><strong>ã‚·ãƒŠãƒªã‚ª1 (ã‚³ãƒ¼ãƒ‰ã‚¨ãƒ©ãƒ¼):</strong> ${codeErrorStatus}</div>
                    <div><strong>ã‚·ãƒŠãƒªã‚ª2 (DBã‚¨ãƒ©ãƒ¼):</strong> ${dbErrorStatus}</div>
                    <div><strong>ã‚·ãƒŠãƒªã‚ª3 (ãƒªã‚½ãƒ¼ã‚¹ä¸è¶³):</strong> ${resourceErrorStatus}</div>
                    <div style="border-top: 1px solid #eee; margin-top: 10px; padding-top: 10px;">
                        <div><strong>ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹:</strong> ${dbStatus}</div>
                        <div><strong>å–å¼•æ•°:</strong> ${data.transactionCount}</div>
                    </div>
                </div>
            `;
        }
        
        document.getElementById('paymentForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const resultDiv = document.getElementById('result');
            resultDiv.className = 'result processing';
            resultDiv.innerHTML = '<div class="loading"></div>æ±ºæ¸ˆå‡¦ç†ä¸­...';
            
            const formData = {
                amount: parseFloat(document.getElementById('amount').value),
                cardNumber: document.getElementById('cardNumber').value,
                storeId: document.getElementById('storeId').value
            };
            
            try {
                const response = await fetch('/api/payment', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(formData)
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    resultDiv.className = 'result success';
                    resultDiv.innerHTML = `<strong>æ±ºæ¸ˆæˆåŠŸï¼</strong><div>å–å¼•ID: ${data.transactionId}</div>`;
                    cart = [];
                    setTimeout(() => {
                        document.getElementById('checkout-form').classList.remove('active');
                        document.getElementById('shop').classList.add('active');
                    }, 2000);
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.innerHTML = `<strong>ã‚¨ãƒ©ãƒ¼</strong><div>${data.detail.message || data.detail.error}</div>`;
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `<strong>ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼</strong><div>${error.message}</div>`;
            }
        });
        
        async function testRDSConnection() {
            const resultDiv = document.getElementById('rdsTestResult');
            resultDiv.innerHTML = '<div class="result processing"><div class="loading"></div>RDSæ¥ç¶šãƒ†ã‚¹ãƒˆä¸­...</div>';
            
            try {
                const response = await fetch('/api/db-test');
                const data = await response.json();
                
                if (response.ok && data.status === 'connected') {
                    resultDiv.innerHTML = `
                        <div class="result success">
                            <strong>âœ… RDSæ¥ç¶šæˆåŠŸ</strong>
                            <div style="margin-top: 10px; font-size: 13px;">
                                <div><strong>ãƒ›ã‚¹ãƒˆ:</strong> ${data.connectionInfo.host}</div>
                                <div><strong>ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹:</strong> ${data.connectionInfo.database}</div>
                                <div><strong>ãƒ¦ãƒ¼ã‚¶ãƒ¼:</strong> ${data.connectionInfo.user}</div>
                                <div><strong>ç·ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³æ•°:</strong> ${data.totalTransactions}</div>
                                <div><strong>DBãƒãƒ¼ã‚¸ãƒ§ãƒ³:</strong> ${data.dbVersion.substring(0, 50)}...</div>
                                <div><strong>DBæ™‚åˆ»:</strong> ${new Date(data.currentTime).toLocaleString('ja-JP')}</div>
                            </div>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `<div class="result error"><strong>âŒ æ¥ç¶šã‚¨ãƒ©ãƒ¼</strong><div>${data.error || 'ä¸æ˜ãªã‚¨ãƒ©ãƒ¼'}</div></div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="result error"><strong>âŒ æ¥ç¶šå¤±æ•—</strong><div>${error.message}</div></div>`;
            }
        }
        
        async function loadTransactions() {
            const listDiv = document.getElementById('transactionList');
            listDiv.innerHTML = '<div class="result processing"><div class="loading"></div>èª­ã¿è¾¼ã¿ä¸­...</div>';
            
            try {
                const response = await fetch('/api/transactions');
                const data = await response.json();
                
                if (data.transactions && data.transactions.length > 0) {
                    listDiv.innerHTML = `
                        <div style="background: white; padding: 15px; border-radius: 8px; border: 1px solid #ddd;">
                            <div style="font-weight: bold; margin-bottom: 10px;">ç·ä»¶æ•°: ${data.transactions.length}ä»¶</div>
                            ${data.transactions.map(t => `
                                <div style="border-bottom: 1px solid #eee; padding: 10px 0; font-size: 13px;">
                                    <div><strong>ID:</strong> ${t.transaction_id}</div>
                                    <div><strong>é‡‘é¡:</strong> Â¥${parseFloat(t.amount).toLocaleString()}</div>
                                    <div><strong>åº—èˆ—:</strong> ${t.store_id}</div>
                                    <div><strong>ã‚«ãƒ¼ãƒ‰:</strong> ${t.card_number}</div>
                                    <div><strong>æ—¥æ™‚:</strong> ${new Date(t.created_at).toLocaleString('ja-JP')}</div>
                                </div>
                            `).join('')}
                        </div>
                    `;
                } else {
                    listDiv.innerHTML = '<div class="result">ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ãŒã‚ã‚Šã¾ã›ã‚“</div>';
                }
            } catch (error) {
                listDiv.innerHTML = `<div class="result error"><strong>ã‚¨ãƒ©ãƒ¼</strong><div>${error.message}</div></div>`;
            }
        }
        
        async function clearTransactions() {
            if (!confirm('æœ¬å½“ã«å…¨ã¦ã®ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) return;
            
            const resultDiv = document.getElementById('clearResult');
            resultDiv.innerHTML = '<div class="result processing"><div class="loading"></div>å‰Šé™¤ä¸­...</div>';
            
            try {
                const response = await fetch('/api/transactions/clear', { method: 'DELETE' });
                const data = await response.json();
                
                if (response.ok) {
                    resultDiv.innerHTML = `<div class="result success"><strong>âœ… å‰Šé™¤å®Œäº†</strong><div>${data.deleted}ä»¶ã®ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã‚’å‰Šé™¤ã—ã¾ã—ãŸ</div></div>`;
                    loadTransactions();
                } else {
                    resultDiv.innerHTML = `<div class="result error"><strong>âŒ å‰Šé™¤å¤±æ•—</strong><div>${data.error}</div></div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="result error"><strong>âŒ ã‚¨ãƒ©ãƒ¼</strong><div>${error.message}</div></div>`;
            }
        }
        
        renderProducts();
    </script>
</body>
</html>
